(()=>{var x=Object.defineProperty;var b=(e,t,s)=>t in e?x(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s;var o=(e,t,s)=>b(e,typeof t!="symbol"?t+"":t,s);window.SECRETS=(async()=>{try{let e=await fetch(atob("L2J0MW9oOTdqN1guYmlu"),{cache:"no-store"});if(!e.ok)throw new Error("Error loading secrets: ".concat(e.status));return JSON.parse(atob((await e.text()).trim().replace(/[A-Za-z]/g,t=>{let s=t<="Z"?65:97;return String.fromCharCode((t.charCodeAt(0)-s+13)%26+s)})))}catch(e){console.error(e.message)}})();self.create=(e,t=null,s=null,i={})=>{let n=document.createElement(e);return t&&(n.className=t),s&&(n.innerHTML=s),Object.entries(i).forEach(r=>n.setAttribute(r[0],r[1])),n};HTMLElement.prototype.create=function(e,t=null,s=null,i={}){let n=create(e,t,s,i);return this.append(n),n};self.documentReady=function(e=null){return new Promise(t=>{document.readyState==="loading"?document.addEventListener("DOMContentLoaded",async()=>{e&&e(),t()},{once:!0}):(e&&e(),t())})};self.loadJsonProperties=async function(e,t={}){let s=Object.entries(t),i=await Promise.allSettled(s.map(async([n,r])=>{let a=await fetch(r),l=null;try{l=await a.json()}catch{}return{key:n,url:r,status:a.status,ok:a.ok,data:l}}));for(let n of i)if(n.status==="fulfilled"){let{key:r,url:a,status:l,ok:c,data:p}=n.value;if(!c){console.error("".concat(r," [").concat(l," - ERREUR] ").concat(a));continue}e[r]=p}else console.error("Erreur r\xE9seau/JS pendant le chargement :",n.reason);return e};self.browse=e=>new Promise((t,s)=>{let i=document.createElement("input");i.type="file",i.accept=e,i.addEventListener("change",()=>{i.files.length>0?t(i.files[0]):s("cancelled")});let n=()=>{setTimeout(()=>{i.files.length||s("cancelled"),window.removeEventListener("focus",n)},200)};window.addEventListener("focus",n),i.click()});self.escapeForAttr=e=>e.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;");self.rem=e=>e*parseFloat(getComputedStyle(document.documentElement).fontSize);self.sleep=e=>new Promise(t=>setTimeout(t,e));self.preloadImage=e=>new Promise((t,s)=>{let i=new Image;i.decoding="async",i.loading="eager",i.onload=()=>t("preloaded"),i.onerror=s,i.src=e,i.complete&&i.naturalWidth>0&&t("memory-cache")});self.copyToClipboard=async e=>{if(navigator.clipboard&&typeof navigator.clipboard.writeText=="function")try{return await navigator.clipboard.writeText(e),!0}catch{}try{let t=document.createElement("textarea");t.value=e,t.style.position="fixed",t.style.top="-9999px",t.style.left="-9999px",t.style.opacity="0",document.body.appendChild(t),t.focus(),t.select();let s=document.execCommand("copy");return document.body.removeChild(t),s}catch{return!1}};self.pad=e=>String(e).padStart(2,"0");self.fmtDate=e=>"".concat(e.getFullYear(),"-").concat(pad(e.getMonth()+1),"-").concat(pad(e.getDate()));self.isoLocal=e=>new Date(e).toISOString();self.addDays=(e,t)=>new Date(e.getFullYear(),e.getMonth(),e.getDate()+t);self.inTZ=(e,t="America/Toronto")=>new Date(e).toLocaleDateString("fr-CA",{timeZone:t});self.ymd=e=>new Date(e.getFullYear(),e.getMonth(),e.getDate()).toISOString().slice(0,10);self.startOfWeek=(e,t=0)=>{let s=new Date(e.getFullYear(),e.getMonth(),e.getDate()),i=(s.getDay()-t+7)%7;return s.setDate(s.getDate()-i),s};self.rectOf=e=>e.getBoundingClientRect();self.clamp=(e,t,s)=>Math.min(s,Math.max(t,e));self.distance=(e,t)=>Math.hypot(e.x-t.x,e.y-t.y);self.midpoint=(e,t)=>({x:(e.x+t.x)/2,y:(e.y+t.y)/2});self.hcd=(e,t)=>{do var s=e;while((t=s%(e=t))>0);return e};({switch:null,mutexVwpx:null,init:async function(){let e=localStorage.getItem("theme");e&&document.documentElement.setAttribute("data-theme",e),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",t=>this.setTheme(t.matches?"dark":"light")),document.documentElement.style.setProperty("--vwpx",String(window.innerWidth)),document.addEventListener("DOMContentLoaded",async()=>{let t=document.body.create("div","lightswitch");t.addEventListener("click",()=>this.toogleTheme()),t.title="Nuit / Jour"}),window.addEventListener("resize",()=>{this.mutexVwpx==null&&(this.mutexVwpx=requestAnimationFrame(()=>{document.documentElement.style.setProperty("--vwpx",String(window.innerWidth)),this.mutexVwpx=null}))})},getTheme:function(){return getComputedStyle(document.documentElement).getPropertyValue("--theme").replace(/^['"]|['"]$/g,"").toLocaleLowerCase().trim()},setTheme:function(e){document.documentElement.setAttribute("data-theme",e),localStorage.setItem("theme",e)},toogleTheme:function(){this.setTheme(this.getTheme()==="dark"?"light":"dark")}}).init();var m=class{constructor(t,s={}){o(this,"container",null);o(this,"opts",{onFileDrop:null});this.opts={...this.opts,...s},typeof t!="string"?this.container=t:this.container=document.querySelector(t),this.container.addEventListener("dragover",i=>i.preventDefault()),this.container.addEventListener("dragenter",i=>this.dragEnter(i)),this.container.addEventListener("dragleave",i=>this.dragLeave(i)),this.container.addEventListener("drop",i=>this.drop(i))}dragEnter(t){t.preventDefault(),this.container.classList.add("dragover")}dragLeave(t){this.container.classList.remove("dragover")}async drop(t){t.preventDefault(),t.dataTransfer.files.length>0&&await this.opts.onFileDrop?.(t.dataTransfer.files[0]),this.container.classList.remove("dragover")}};var h=class{constructor(t,s){o(this,"state",{scale:1,minScale:1,maxScale:8,tx:0,ty:0,imgW:0,imgH:0,frameW:0,frameH:0});o(this,"pointers",new Map);o(this,"pinchStart",null);o(this,"lastTapTime",0);o(this,"mutex",null);o(this,"zoomTimer",null);o(this,"ratio",null);o(this,"frame",null);o(this,"img",null);o(this,"url",null);typeof t!="string"?this.frame=t:this.frame=document.querySelector(t),this.ratio=this.parseAspect(s),this.frame.style.aspectRatio="".concat(this.ratio.w," / ").concat(this.ratio.h),this.img=this.frame.create("img"),this.frame.addEventListener("wheel",i=>this.onWheel(i),{passive:!1}),this.frame.addEventListener("pointerdown",i=>this.onPointerDown(i)),this.frame.addEventListener("pointermove",i=>this.onPointerMove(i)),this.frame.addEventListener("pointerup",i=>this.endPointer(i)),this.frame.addEventListener("pointercancel",i=>this.endPointer(i)),this.frame.addEventListener("pointerleave",i=>{this.pointers.has(i.pointerId)&&this.endPointer(i)}),window.addEventListener("resize",()=>this.onResize())}loadImage(t){return new Promise(s=>{this.url=URL.createObjectURL(t),this.img.onload=()=>{this.state.imgW=this.img.naturalWidth,this.state.imgH=this.img.naturalHeight,URL.revokeObjectURL(this.url),s(this.fitCover())},this.img.src=this.url})}onResize(){!this.mutex&&this.img&&(this.mutex=requestAnimationFrame(()=>this.fitCover().then(()=>this.mutex=null)))}onWheel(t){t.preventDefault(),clearTimeout(this.zoomTimer),this.frame.classList.toggle("zooming-in",t.deltaY<0),this.frame.classList.toggle("zooming-out",t.deltaY>0),this.zoomTimer=setTimeout(()=>this.frame.classList.remove("zooming-in","zooming-out"),200);let s=this.state.scale*Math.exp(-t.deltaY*.001);this.zoomAt(t.clientX,t.clientY,s)}onPointerDown(t){this.frame.setPointerCapture(t.pointerId),this.setPointer(t);let s=performance.now();s-this.lastTapTime<280&&this.pointers.size===1?this.fitCover().then(()=>this.lastTapTime=0):this.lastTapTime=s}onPointerMove(t){if(!this.pointers.has(t.pointerId))return;let s=this.pointers.get(t.pointerId);if(this.setPointer(t),this.pointers.size===2){let[i,n]=[...this.pointers.values()],r=midpoint(i,n),a=distance(i,n);if(!this.pinchStart)this.pinchStart={dist:a,scale:this.state.scale,tx:this.state.tx,ty:this.state.ty};else{let l=a/(this.pinchStart.dist||1);this.zoomAt(r.x,r.y,clamp(this.pinchStart.scale*l,this.state.minScale,this.state.maxScale))}}else this.pointers.size===1&&(this.state.tx+=t.clientX-s.x,this.state.ty+=t.clientY-s.y,this.applyTransform())}fitCover(){let t=rectOf(this.frame);this.state.frameW=t.width,this.state.frameH=t.height;let s=this.state.imgW||this.img.naturalWidth||1,i=this.state.imgH||this.img.naturalHeight||1;this.state.imgW=s,this.state.imgH=i;let n=Math.max(this.state.frameW/s,this.state.frameH/i)||1;this.state.minScale=n,this.state.maxScale=n*8,this.state.scale=n;let r=s*n,a=i*n;return this.state.tx=(this.state.frameW-r)/2,this.state.ty=(this.state.frameH-a)/2,this.applyTransform()}applyTransform(){let t=this.state.imgW*this.state.scale,s=this.state.imgH*this.state.scale,i=this.state.frameW-t,n=0,r=this.state.frameH-s,a=0;return this.state.tx=clamp(this.state.tx,i,n),this.state.ty=clamp(this.state.ty,r,a),new Promise(l=>l(this.img.style.transform="translate3d(".concat(this.state.tx,"px, ").concat(this.state.ty,"px, 0) scale(").concat(this.state.scale,")")))}zoomAt(t,s,i){let n=rectOf(this.frame),r=t-n.left,a=s-n.top,l=this.state.scale,c=clamp(i,this.state.minScale,this.state.maxScale);if(c!==this.state.scale)return this.state.tx=r-(r-this.state.tx)*(c/l),this.state.ty=a-(a-this.state.ty)*(c/l),this.state.scale=c,this.applyTransform()}setPointer(t){this.pointers.set(t.pointerId,{x:t.clientX,y:t.clientY})}delPointer(t){this.pointers.delete(t.pointerId)}endPointer(t){this.delPointer(t),this.pointers.size<2&&(this.pinchStart=null)}parseAspect(t){let s=String(t).replace(/\s+/g,"").match(/^(\d+(?:\.\d+)?)[\/:](\d+(?:\.\d+)?)$/);return s?{w:parseFloat(s[1]),h:parseFloat(s[2])}:{w:5,h:4}}exportBlob(t,s="webp"){if(!this.img.src)throw new Error("Aucune image charg\xE9e.");let i=this.frame.clientWidth,n=this.frame.clientHeight,r=Math.max(0,-this.state.tx/this.state.scale),a=Math.max(0,-this.state.ty/this.state.scale),l=Math.min(this.state.imgW-r,i/this.state.scale),c=Math.min(this.state.imgH-a,n/this.state.scale),p=this.ratio.w/this.ratio.h,f=Math.round(t/p),d=document.createElement("canvas");d.width=t,d.height=f;let g=d.getContext("2d",{alpha:s!=="jpeg"});return g.imageSmoothingQuality="high",g.drawImage(this.img,r,a,l,c,0,0,t,f),new Promise((y,v)=>d.toBlob(w=>w?y(w):v(new Error("toBlob() a \xE9chou\xE9")),"image/".concat(s),.92))}};var u=class{constructor(){o(this,"elm",null);o(this,"timeout",null);o(this,"duration",3e3);this.elm=document.body.create("div","notification")}thumbsUp(t){this.show(t,"thumbsup")}error(t){this.show(t,"error")}show(t,s){this.elm.innerHTML=t,this.elm.className="notification ".concat(s," show"),this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(()=>{this.elm.className="notification",this.timeout=null},this.duration)}};({API_ENDPOINT:"https://images.action.quebec",secrets:null,container:null,selorg:null,seltype:null,imagegroup:null,imageL:null,imageR:null,image:null,frameL:null,frameR:null,btngroup:null,uploadbtn:null,browsebtn:null,results:null,copybtn:null,browse2btn:null,links:null,splash:null,splashdnd:null,loader:null,notif:null,init:async function(){Promise.all([this.loadSecrets(),documentReady(()=>this.initUI())])},loadSecrets:async function(){this.secrets=await SECRETS},initUI:async function(){this.container=document.querySelector(".croper"),this.imagegroup=create("div","croper__images"),this.image=create("img"),this.imageL=this.imagegroup.create("div","croper__images__box box--2-3"),this.imageR=this.imagegroup.create("div","croper__images__box box--5-4"),this.imageL.title="Utilisez la molette pour zoomer",this.imageR.title="Utilisez la molette pour zoomer",this.btngroup=create("div","croper__button"),this.uploadbtn=this.btngroup.create("button",null,"T\xE9l\xE9verser"),this.uploadbtn.addEventListener("click",()=>this.uploadFiles()),this.browsebtn=this.btngroup.create("button",null,"Parcourir"),this.browsebtn.addEventListener("click",()=>this.browseFile()),this.results=create("div","croper__results"),this.results.create("div","croper__results__winner").title="Tu veux-tu une m\xE9daille?",this.results.create("div","croper__results__congrats","F\xE9licitations!"),this.results.create("div","croper__results__text","Image t\xE9l\xE9vers\xE9e avec succ\xE8s. Il ne reste qu\u2019\xE0 copier les liens et les coller dans la description de votre \xE9v\xE9nement.");let e=this.results.create("div","croper__results__btn");this.copybtn=e.create("button","croper__results__copy","Copier les liens"),this.copybtn.addEventListener("click",()=>this.copyLinks()),this.browse2btn=e.create("button","croper__results__browse","Parcourir"),this.browse2btn.addEventListener("click",()=>this.browseFile()),this.splash=create("div","croper__splash show","Glissez-d\xE9posez votre image ici ou<br> cliquez ici pour choisir un fichier."),this.splash.addEventListener("click",()=>this.browseFile()),this.splashdnd=new m(this.splash,{onFileDrop:t=>this.drop(t)}),this.loader=create("div","croper__loader"),this.loader.create("div","loading-double-circular"),this.frameL=new h(this.imageL,"2/3"),this.frameR=new h(this.imageR,"5:4"),this.notif=new u,this.container.replaceChildren(this.imagegroup,this.btngroup,this.results,this.splash,this.loader)},busy:async function(e){document.documentElement.classList.add("is-busy");let t=await Promise.allSettled(typeof e=="array"?e:[e]);return document.documentElement.classList.remove("is-busy"),typeof e=="array"?t:t[0]},working:async function(e){document.documentElement.classList.add("is-working");let t=await Promise.allSettled(typeof e=="array"?e:[e]);return document.documentElement.classList.remove("is-working"),typeof e=="array"?t:t[0]},handleFile:function(e){return new Promise((t,s)=>{e.type.startsWith("image/")&&e.size<=5242880?t(this.loadImage(e)):s("Fichier rejet\xE9")})},browseFile:async function(){browse("image/*").then(async e=>{await this.handleFile(e)}).catch(e=>this.notif.error("Fichier rejet\xE9"))},drop:function(e){this.handleFile(e).catch(t=>this.notif.error(t))},loadImage:async function(e){this.image.src=URL.createObjectURL(e),await Promise.all([this.frameL.loadImage(e),this.frameR.loadImage(e)]),this.splash.classList.remove("show"),this.results.classList.remove("show")}}).init();})();
